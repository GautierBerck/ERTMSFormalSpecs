<Frame
 CycleDuration="0.1"
 Name="Route suitability - Functional tests"
 Guid="2064d644-0aa2-4ee7-b226-1cad2774a63b"
>
<SubSequences>
<SubSequence
 D_LRBG=""
 Level=""
 Mode=""
 NID_LRBG=""
 Q_DIRLRBG=""
 Q_DIRTRAIN=""
 Q_DLRBG=""
 RBC_ID=""
 RBCPhone=""
 Name="Handle route suitability data from a balise"
 Guid="2de400e8-76dc-4bb1-888a-6f1ac62158d8"
>
<TestCases>
<TestCase
 Name="Receive and store a route suitability message from a balise"
 Guid="07a2596f-970e-4c2b-8ee8-3747a2a0c0ce"
>
<ReqRef
 Id="3eae43ab-6f26-4908-9360-5a8ce0bec069"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="80668661-a2d8-4b86-896d-2436f42f5317"
>
</ReqRef><Steps>
<Step
 IO="NA"
 LevelIN="NA"
 LevelOUT="NA"
 ModeIN="NA"
 ModeOUT="NA"
 Name="Step1 - Initialize train data"
 Guid="5ff6e63a-0856-472e-951f-753e4f7e7fc7"
>
<SubSteps>
<SubStep
 Name="SubStep1 - Initialize test environment"
 Guid="78024ff6-7571-41b0-b8c2-40391d543185"
>
<Actions>
<Action
 Guid="7bd1c3e7-2578-4737-bc35-7bf501ee8089"
>Kernel.InitializeTestEnvironment()</Action></Actions>
</SubStep><SubStep
 Name="Sub-step2 - Setup for the BG"
 Guid="b7fc74df-4aa7-47f0-8ab5-43cd83d7857e"
>
<Actions>
<Action
 Guid="f12bf86a-c22c-4e25-aea2-a43022dae57e"
>BTM.LRBG &lt;- EMPTY</Action><Action
 Guid="da854a71-291c-446c-bf14-78cd1f1c1eb5"
>BTM.PreviousLRBGs &lt;- []</Action><Action
 Guid="c52d0e63-7526-4e71-a8e0-641715e2cf29"
>Odometry.NominalDistance &lt;- 0.0</Action></Actions>
</SubStep></SubSteps>
</Step><Step
 IO="NA"
 LevelIN="NA"
 LevelOUT="NA"
 ModeIN="NA"
 ModeOUT="NA"
 Name="Step2 - Receive a message from the balise"
 Guid="e7e0af1b-05c9-4981-b4e6-b8d366d1bb80"
>
<Comment>The balise transmits a route suitability packet that the train stores</Comment>
<SubSteps>
<SubStep
 Name="SubStep1 - The message gets sent"
 Guid="9f468db7-a6d1-4d77-8b66-df4150604482"
>
<Actions>
<Action
 Guid="3d373245-3e5e-4372-a97c-ad10b6cf9cb4"
>BTM.Message &lt;- Messages.EUROBALISE.Message
 {
    Q_UPDOWN =&gt; Messages.Q_UPDOWN.Up_link_telegram,
    M_VERSION =&gt; 1,
    Q_MEDIA =&gt; Messages.Q_MEDIA.Balise,
    N_PIG =&gt; Messages.N_PIG._1C,
    N_TOTAL =&gt; Messages.N_TOTAL._1_balise_in_groupC,
    M_DUP =&gt; Messages.M_DUP.No_duplicates,
    M_MCOUNT =&gt; 1,
    NID_C =&gt; 80,
    NID_BG =&gt; 256,
    Q_LINK =&gt; Messages.Q_LINK.Unlinked,
    Sequence1 =&gt; 
     [
        Messages.EUROBALISE.SubStructure1
         {
            TRACK_TO_TRAIN=&gt;Messages.PACKET.TRACK_TO_TRAIN.Message
             {
                ROUTE_SUITABILITY_DATA =&gt; Messages.PACKET.TRACK_TO_TRAIN.ROUTE_SUITABILITY_DATA.Message
                 {
                      NID_PACKET =&gt; 70,
                      Q_DIR =&gt; Messages.Q_DIR.Nominal,
                      L_PACKET =&gt; 1,
                      Q_SCALE =&gt; Messages.Q_SCALE._1_m_scaleC,
                      Q_TRACKINIT =&gt; 0,

                      D_SUITABILITY =&gt; 500,
                      Q_SUITABILITY =&gt; Messages.Q_SUITABILITY.Loading_gauge_profile,
                      M_LINEGAUGE =&gt; Messages.M_LINEGAUGE.GB,

                      N_ITER =&gt; 2,
                      Sequence1 =&gt; [
                        Messages.PACKET.TRACK_TO_TRAIN.ROUTE_SUITABILITY_DATA.SubStructure1{
                            D_SUITABILITY =&gt; 1000,
                            Q_SUITABILITY =&gt; Messages.Q_SUITABILITY.Max_axle_load,
                            M_AXLELOADCAT =&gt; Messages.M_AXLELOADCAT.D4
                         }
                        ,
                        Messages.PACKET.TRACK_TO_TRAIN.ROUTE_SUITABILITY_DATA.SubStructure1{
                            D_SUITABILITY =&gt; 2000,
                            Q_SUITABILITY =&gt; Messages.Q_SUITABILITY.Traction_system,
                            M_VOLTAGE =&gt; Messages.M_VOLTAGE.AC_25_kV_50_Hz,
                            NID_CTRACTION =&gt; 80
                         }
                     ]
                 }
             }
         }
     ]
 }</Action><Action
 Guid="399fb599-76dc-4a54-acf0-c76531a8f4ef"
>BTM.LRBG &lt;- BTM.BaliseGroup
{
    NID =&gt; 256,
    Orientation =&gt; Default.Orientation.Nominal,
    Position =&gt; BTM.Position
    {
        OverReadingAmountOdo =&gt; 2.0,
        Position =&gt; 250.0,
        UnderReadingAmountOdo =&gt; 2.0

    }
}</Action></Actions>
</SubStep><SubStep
 Name="Sub-step2 - Expectations"
 Guid="48c9c39a-a577-42d9-84b1-c97aff49fca5"
>
<Expectations>
<Expectation
 Kind="Instantaneous"
 DeadLine="1"
 Guid="4c03c706-5e86-437c-996a-a9c74e790cea"
>(LAST_IN Kernel.TrackDescription.RouteSuitability.RouteSuitabilityProfile.Items).Type == Messages.Q_SUITABILITY.Traction_system</Expectation><Expectation
 Kind="Instantaneous"
 DeadLine="1"
 Guid="0c90100c-e33e-4236-b027-3dbd15f18f5b"
>Kernel.TrackDescription.RouteSuitability.RouteSuitabilityProfile.InitialState == 0</Expectation><Expectation
 Kind="Instantaneous"
 DeadLine="1"
 Guid="c5fbed39-6356-4c0e-b7f3-8b4bfc80ccf8"
>(LAST_IN Kernel.TrackDescription.RouteSuitability.RouteSuitabilityProfile.Items).Distance == 2000.0</Expectation><Expectation
 Kind="Instantaneous"
 DeadLine="1"
 Guid="0f08b536-83f1-4e8f-afc9-094f88eb7965"
>(FIRST_IN Kernel.TrackDescription.RouteSuitability.RouteSuitabilityProfile.Items).Distance == 500.0</Expectation><Expectation
 Kind="Instantaneous"
 DeadLine="1"
 Guid="b2be7619-db97-4931-bc20-c69af53c64c0"
>(COUNT Kernel.TrackDescription.RouteSuitability.RouteSuitabilityProfile.Items) == 3</Expectation><Expectation
 Kind="Instantaneous"
 DeadLine="1"
 Guid="b9b55801-26ed-4880-92bd-2ce0858c4896"
>THERE_IS_IN Kernel.TrackDescription.RouteSuitability.RouteSuitabilityProfile.Items | (X.Distance == 1000.0 AND X.Type ==  Messages.Q_SUITABILITY.Max_axle_load AND X.MaxAxleLoad == Messages.M_AXLELOADCAT.D4)</Expectation><Expectation
 Kind="Instantaneous"
 DeadLine="1"
 Guid="0ddeb3ea-caf9-4c79-a64b-3d649f712d85"
>(FIRST_IN Kernel.TrackDescription.RouteSuitability.RouteSuitabilityProfile.Items).Type == Messages.Q_SUITABILITY.Loading_gauge_profile</Expectation><Expectation
 Kind="Instantaneous"
 DeadLine="1"
 Guid="b6aaf730-08d6-4aca-9bde-2736151002b9"
>(LAST_IN Kernel.TrackDescription.RouteSuitability.RouteSuitabilityProfile.Items).TractionSystem == Messages.M_VOLTAGE.AC_25_kV_50_Hz</Expectation><Expectation
 Kind="Instantaneous"
 DeadLine="1"
 Guid="e39e583b-87d0-476f-b422-a14c14ea85b0"
>(FIRST_IN Kernel.TrackDescription.RouteSuitability.RouteSuitabilityProfile.Items).LineGauge == Messages.M_LINEGAUGE.GB</Expectation><Expectation
 Kind="Instantaneous"
 DeadLine="1"
 Guid="d8197f0c-ee80-46df-8db9-476c07187e57"
>(LAST_IN Kernel.TrackDescription.RouteSuitability.RouteSuitabilityProfile.Items).NidCTraction == 80</Expectation></Expectations>
</SubStep></SubSteps>
</Step></Steps>
</TestCase></TestCases>
</SubSequence><SubSequence
 D_LRBG=""
 Level=""
 Mode=""
 NID_LRBG=""
 Q_DIRLRBG=""
 Q_DIRTRAIN=""
 Q_DLRBG=""
 RBC_ID=""
 RBCPhone=""
 Name="Handle route suitability data from the radio"
 Guid="e698e242-c067-40e0-842f-f4c8672a54e9"
>
<TestCases>
<TestCase
 Name="Receive and store the route suitability message"
 Guid="6891e977-c662-429e-ad37-d99c2b3c30e1"
>
<ReqRef
 Id="3eae43ab-6f26-4908-9360-5a8ce0bec069"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="099fb68b-c33d-45f1-bda4-3c7ebce6ec1c"
>
</ReqRef><Steps>
<Step
 IO="NA"
 LevelIN="NA"
 LevelOUT="NA"
 ModeIN="NA"
 ModeOUT="NA"
 Name="Step 1 - Initialize train data"
 Guid="ba9edc56-46b9-4655-8229-cb1c3021aff9"
>
<SubSteps>
<SubStep
 Name="SubStep1"
 Guid="67dd5af6-9556-4514-b693-e5eba7d8f51e"
>
<Actions>
<Action
 Guid="425052ae-e9d4-4429-82ea-2e35dc61bf06"
>Kernel.InitializeTestEnvironment()</Action></Actions>
</SubStep></SubSteps>
</Step><Step
 IO="NA"
 LevelIN="NA"
 LevelOUT="NA"
 ModeIN="NA"
 ModeOUT="NA"
 Name="Step 2"
 Guid="5bc76fa3-2c5b-4e59-af1c-db717d063e6f"
>
<SubSteps>
<SubStep
 Name="SubStep1"
 Guid="b9f2e941-f060-42f8-b92f-eb6e080ac991"
>
<Actions>
<Action
 Guid="2c187fbe-54a3-4bd3-82e8-ae0284bb8369"
>EURORADIO.EuroradioMessageIn &lt;- Messages.MESSAGE.TRACK_TO_TRAIN.Message
 {
    GENERAL_MESSAGE =&gt; Messages.MESSAGE.TRACK_TO_TRAIN.GENERAL_MESSAGE.Message
     {
        NID_MESSAGE =&gt; 24,
        L_MESSAGE =&gt; 1,
        T_TRAIN =&gt; 6542,
        M_ACK =&gt; Messages.M_ACK.No_acknowledgement_required,
        NID_LRBG =&gt; 2547635,
        Sequence1 =&gt;
         [
            Messages.MESSAGE.TRACK_TO_TRAIN.GENERAL_MESSAGE.SubStructure1
             {
                ROUTE_SUITABILITY_DATA =&gt; Messages.PACKET.TRACK_TO_TRAIN.ROUTE_SUITABILITY_DATA.Message
                 {
                    NID_PACKET =&gt; 70,
                    Q_DIR =&gt; Messages.Q_DIR.Both_directions,
                    L_PACKET =&gt; 1,
                    Q_SCALE =&gt; Messages.Q_SCALE._1_m_scaleC,
                    Q_TRACKINIT =&gt; Messages.Q_TRACKINIT.No_initial_states_to_be_resumed__profile_to_follow,

                    D_SUITABILITY =&gt; 1200,
                    Q_SUITABILITY =&gt; Messages.Q_SUITABILITY.Max_axle_load,
                    M_AXLELOADCAT =&gt; Messages.M_AXLELOADCAT.C4,

                    N_ITER =&gt; 0,
                    Sequence1 =&gt; []
                 }
             }
         ]
     }
}</Action></Actions>
</SubStep><SubStep
 Name="Sub-step2"
 Guid="4460208e-93c7-46d4-93bf-86fcf3c5676a"
>
<Expectations>
<Expectation
 Kind="Instantaneous"
 DeadLine="1"
 Guid="28e64a49-e8dc-4197-8e2d-7f4f99e77146"
>(COUNT Kernel.TrackDescription.RouteSuitability.RouteSuitabilityProfile.Items) == 1</Expectation></Expectations>
</SubStep></SubSteps>
</Step></Steps>
</TestCase></TestCases>
</SubSequence></SubSequences>
</Frame>
