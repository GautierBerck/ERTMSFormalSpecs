<NameSpace
 X="10"
 Y="130"
 Width="100"
 Height="50"
 Name="BrakeCommands"
 Guid="fd5695eb-c4e5-4f36-a75a-736b7b5c97ea"
>
<NameSpaces>
</NameSpaces>
<Enumerations>
<Enum
 Default="Kernel.BrakeCommands.BrakeReason.SupervisingStandstill"
 X="380"
 Y="260"
 Width="100"
 Height="50"
 Pinned="TRUE"
 Implemented="TRUE"
 Name="BrakeReason"
 Guid="0fb8e0ec-b6c6-4517-b005-253d3c0ebdea"
>
<ReqRef
 Id="ce7d1ef1-5c76-4031-a912-dd0416fd0924"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="6b8d455d-eb79-4af0-a1a2-a854ac0ed25e"
>
</ReqRef><Comment>Enumerates all the possible reasons for the emergency brakes to be tripped</Comment>
<Values>
<EnumValue
 Value=""
 Name="OrderFromRBC"
 Guid="0b225f61-844c-4a87-8946-d28a505473e4"
>
</EnumValue><EnumValue
 Value=""
 Name="BaliseGroupMessageInconsistency"
 Guid="e008b5cc-8185-4108-9ae7-3d5a8e532bcf"
>
</EnumValue><EnumValue
 Value=""
 Name="RAMSSupervision"
 Guid="31bfc0c1-770f-4d78-8706-6f1e43dbc5c6"
>
</EnumValue><EnumValue
 Value=""
 Name="SpeedAndDistanceMonitoring"
 Guid="d3eeb92d-e1ef-4689-b1b2-889c691cac61"
>
</EnumValue><EnumValue
 Value=""
 Name="SupervisingStandstill"
 Guid="dbdb40ad-af6e-4af1-9431-43d70d92385b"
>
</EnumValue><EnumValue
 Value=""
 Name="RadioSequenceError"
 Guid="6d4ca0b1-2154-4eb7-9ea7-7e240d59ac35"
>
</EnumValue><EnumValue
 Value=""
 Name="RadioMessageConsistencyError"
 Guid="bf743a0f-d096-463c-a36a-658f55eab25f"
>
</EnumValue><EnumValue
 Value=""
 Name="NoRadioMessageInDueTime"
 Guid="25562908-959f-403c-8c52-1eaa49012735"
>
</EnumValue><EnumValue
 Value=""
 Name="LSAckTimeOut"
 Guid="d35436c1-e751-4fd2-84c1-b0bb6419f2fa"
>
</EnumValue><EnumValue
 Value=""
 Name="OSAckTimeOut"
 Guid="338ef8a2-6bf9-4cad-98c2-0181cc205fca"
>
</EnumValue><EnumValue
 Value=""
 Name="SHAckTimeOut"
 Guid="5e8d54a2-8912-4abc-aa1a-8af63befba3a"
>
</EnumValue><EnumValue
 Value=""
 Name="LevelTransitionTimeOut"
 Guid="5ed77a1e-e3bc-41dd-bc6f-01148d2c74f0"
>
</EnumValue><EnumValue
 Value=""
 Name="TrainTrip"
 Guid="d204bcf0-3f49-40b5-88a4-80dbc7c0af37"
>
</EnumValue><EnumValue
 Value=""
 Name="RollAwayProtection"
 Guid="55cc1ba7-4352-4e83-a313-c13353fe6c10"
>
</EnumValue><EnumValue
 Value=""
 Name="ReverseMovementProtection"
 Guid="7ca25367-fdc8-426c-b4ed-d7a32daa8ed9"
>
</EnumValue><EnumValue
 Value=""
 Name="LinkingInconsistency"
 Guid="6bdf2c3e-b6fd-4072-9095-7ade9ff00bae"
>
</EnumValue><EnumValue
 Value=""
 Name="ReversingDistanceExceeded"
 Guid="c55596d6-9079-4e5e-aefa-e429416f8b02"
>
</EnumValue><EnumValue
 Value=""
 Name="TextMessageAckTimeOut"
 Guid="3573ee7c-3fe0-4b46-818f-fb9b3c65e22f"
>
</EnumValue><EnumValue
 Value=""
 Name="TrainMovementDuringDataEntry"
 Guid="cd962dc2-f111-4e7d-a510-18b646f1489d"
>
</EnumValue><EnumValue
 Value=""
 Name="TrainDataChanged"
 Guid="c4831024-f248-480d-bfb4-6183361a2f1d"
>
</EnumValue><EnumValue
 Value=""
 Name="PermanentCommandInCurrentMode"
 Guid="26ee74b9-cb6b-4277-80a2-337fa9f7cd6f"
>
</EnumValue><EnumValue
 Value=""
 Name="ServiceBrakeNotApplied"
 Guid="13cc95ca-a8d6-4d7e-ba15-a4afeccea8f7"
>
</EnumValue><EnumValue
 Value=""
 Name="PTReversingDistanceExceeded"
 Guid="d5e8ae58-8ed0-453f-be57-1cf31c760047"
>
</EnumValue></Values>
</Enum></Enumerations>
<Structures>
<Structure
 Default=""
 X="340"
 Y="120"
 Width="100"
 Height="50"
 Pinned="TRUE"
 Implemented="TRUE"
 Name="EmergencyStopStruct"
 Guid="7b0227c8-823b-44f7-9095-f54804077a15"
>
<ReqRef
 Id="2b2cca84-5637-4f57-be10-029b36aa0f1a"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="b3eb6b9f-b1c1-453c-9d67-32adc227b25b"
>
</ReqRef><Comment>Represents a received emergency stop (conditional or unconditional).</Comment>
<StructureElement
 TypeName="Boolean"
 Default="Boolean.False"
 Mode="Internal"
 Implemented="TRUE"
 NeedsRequirement="FALSE"
 Name="IsConditional"
 Guid="885852da-4124-46b9-b30e-2dee3e29e568"
>
<Comment>Indicates if this emergency stop is conditional or not.</Comment>
</StructureElement><StructureElement
 TypeName="Messages.NID_EM"
 Default="0"
 Mode="Internal"
 Implemented="TRUE"
 NeedsRequirement="FALSE"
 Name="Id"
 Guid="8348abbd-53c8-4857-9938-7fb0f933f091"
>
<ReqRef
 Id="ce7d1ef1-5c76-4031-a912-dd0416fd0924"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="82e334c9-325e-4b85-a43f-f2a5ebb174b2"
>
</ReqRef><Comment>The id of the emergency stop.</Comment>
</StructureElement><StructureElement
 TypeName="BaseTypes.Distance"
 Default=""
 Mode="Internal"
 Implemented="TRUE"
 NeedsRequirement="FALSE"
 Name="StopLocation"
 Guid="fc9c12ce-a392-4872-b338-33898df64176"
>
<Comment>The stop location of this emergency stop.</Comment>
</StructureElement><StructureElement
 TypeName="BrakeReason"
 Default=""
 Mode="Internal"
 Implemented="TRUE"
 Name="Reason"
 Guid="3f89f43d-554f-45d9-b2ea-ad274c34225c"
>
</StructureElement></Structure></Structures>
<Collections>
<Collection
 TypeName="BrakeReason"
 Default="[]"
 X="400"
 Y="380"
 Width="100"
 Height="50"
 Implemented="TRUE"
 NeedsRequirement="FALSE"
 Name="BrakesCol"
 Guid="6669d59f-32a9-4f72-a752-3f117d072ea4"
>
</Collection><Collection
 TypeName="EmergencyStopStruct"
 Default="[]"
 X="180"
 Y="120"
 Width="100"
 Height="50"
 Pinned="TRUE"
 Implemented="TRUE"
 Name="EmergencyStopsCol"
 Guid="9543cdba-100d-4b27-90d5-f248e12b2645"
>
<ReqRef
 Id="2b2cca84-5637-4f57-be10-029b36aa0f1a"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="86a8a1ef-1413-4149-a201-8321cc79420a"
>
</ReqRef><ReqRef
 Id="19082c8b-d1cc-4d23-a9da-8581737a0760"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="a005923c-ed2e-44ff-84c8-450e7870ef82"
>
</ReqRef><ReqRef
 Id="fed0816f-33b0-4ae0-82ce-ac9e35a4efc2"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="73f066da-96ea-453a-89c4-ae5c66e9727f"
>
</ReqRef><Comment>Collection holding structures of type Kernel.EmergencyStop</Comment>
</Collection></Collections>
<Functions>
<Function
 Type="EmergencyStopStruct"
 Default=""
 X="30"
 Y="270"
 Width="100"
 Height="50"
 Pinned="TRUE"
 Implemented="TRUE"
 Name="CreateEmergencyStop"
 Guid="ed5c4ddd-670a-414d-961c-9ef4c2963243"
>
<ReqRef
 Id="2b2cca84-5637-4f57-be10-029b36aa0f1a"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="d1d46788-be76-4ae3-a73b-8dba6b6c10e8"
>
</ReqRef><Comment>Creates an EmergencyStop from a Conditional or Unconditional Emergency Stop messages</Comment>
<Parameters>
<Parameter
 Type="Boolean"
 Name="aIsConditional"
 Guid="641cccc5-1c47-4e1e-9928-d7a0d1128dbc"
>
</Parameter><Parameter
 Type="Messages.NID_EM"
 Name="aId"
 Guid="e5980230-2325-4db0-b47e-ba389b5f6219"
>
</Parameter><Parameter
 Type="BaseTypes.Distance"
 Name="aStopLocation"
 Guid="95bdb748-fd62-4493-beab-82cc872754c0"
>
</Parameter></Parameters>
<Cases>
<Case
 Name="Value"
 Guid="d21e63ba-bec7-41f2-a0f1-e5ad05e4c49a"
>
<Expression>Kernel.BrakeCommands.EmergencyStopStruct
 {
    Reason =&gt; BrakeCommands.BrakeReason.OrderFromRBC,
    IsConditional =&gt; aIsConditional,
    Id =&gt; aId,
    StopLocation =&gt; aStopLocation
 }</Expression>
</Case></Cases>
</Function><Function
 Type="EmergencyStopStruct"
 Default=""
 X="200"
 Y="210"
 Width="100"
 Height="50"
 Pinned="TRUE"
 Implemented="TRUE"
 Name="ClosestStopLocation"
 Guid="60af8f56-9ae5-4e3d-b04a-709236d5e630"
>
<ReqRef
 Id="4f290d49-e10d-41ae-a385-d9a756df04d3"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="b04396c3-8252-4401-9f39-534abc4e286e"
>
</ReqRef><Comment>Takes a collection of Emergency Stops and returns the closest conditional emergency stop</Comment>
<Parameters>
<Parameter
 Type="EmergencyStopsCol"
 Name="aESCol"
 Guid="ac51e9d6-df83-443b-a2dc-d4b7dfa198c1"
>
</Parameter></Parameters>
<Cases>
<Case
 Name="Return the closest conditional ES"
 Guid="6504658f-9677-4b71-97ed-e60c579ccab0"
>
<Expression>REDUCE aESCol | ( X.Reason == Kernel.BrakeCommands.BrakeReason.OrderFromRBC AND X.IsConditional )
    USING X IN Kernel.BrakeCommands.MinEmergencyStopDistance( EmergencyStop1 =&gt; X, EmergencyStop2 =&gt; RESULT )
INITIAL_VALUE Kernel.BrakeCommands.EmergencyStopStruct
                            {
                                StopLocation =&gt; BaseTypes.Distance.Infinity
                            }</Expression>
</Case></Cases>
</Function><Function
 Type="EmergencyStopStruct"
 Default=""
 X="140"
 Y="270"
 Width="100"
 Height="50"
 Pinned="TRUE"
 Implemented="TRUE"
 NeedsRequirement="FALSE"
 Name="MinEmergencyStopDistance"
 Guid="760d41cd-34f8-4a83-8e8d-d49e57d0c208"
>
<Comment>Returns the EmergencyStop item with the closest StopLocation, chosen amongst the conditional emergency stops received from the RBC</Comment>
<Parameters>
<Parameter
 Type="EmergencyStopStruct"
 Name="EmergencyStop1"
 Guid="9e4b6b95-8fc6-4c63-82ae-6cb3353e472b"
>
</Parameter><Parameter
 Type="EmergencyStopStruct"
 Name="EmergencyStop2"
 Guid="96fac747-08ca-4dbf-b46c-6a0b449f934c"
>
</Parameter></Parameters>
<Cases>
<Case
 Name="First emergency stop is closer"
 Guid="b6da9bf5-c399-43a3-9512-93fc756fa03f"
>
<PreConditions>
<PreCondition
 Guid="d6a8ab20-c3ba-4803-81b5-94d9115414fd"
>EmergencyStop1.StopLocation &lt; EmergencyStop2.StopLocation</PreCondition></PreConditions>
<Expression>EmergencyStop1</Expression>
</Case><Case
 Name="Otherwise"
 Guid="da188692-c1fd-43cd-9f56-3e4f3ed573be"
>
<Expression>EmergencyStop2</Expression>
</Case></Cases>
</Function><Function
 Type="Boolean"
 X="30"
 Y="210"
 Width="100"
 Height="50"
 Implemented="TRUE"
 Name="CanRevokeReversingBrake"
 Guid="a54321d3-e792-44b3-a81c-7452a8450fa4"
>
<ReqRef
 Id="8d6f8085-1ab8-4354-a7b3-65a964c3c0c2"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="6a9acb5f-f151-4356-b9a3-09f2dc0a688b"
>
</ReqRef><Comment>Checks whether the brake command due to an overpassed reversing distance can be revoked.</Comment>
<Cases>
<Case
 Name="Reversing distance extended"
 Guid="51dfad7e-5fb0-476e-bb23-04a5b99661bd"
>
<PreConditions>
<PreCondition
 Guid="f2e1e7f2-f17c-4360-8424-eda57b6f8347"
>Kernel.TrackDescription.ReversingArea.ReversingAreaProfile.Length &gt; Kernel.TrainPosition.DistanceReversed()</PreCondition></PreConditions>
<Expression>True</Expression>
</Case><Case
 Name="At standstill after driver acknowledgement"
 Guid="3ba0826a-da17-4112-8254-383241b220f8"
>
<Expression>Odometry.TrainIsAtStandstill()
  AND  
DMI.MasterDMI().In_AcknForReversingDistanceExceeded.InputInformation.DriverAnswered</Expression>
</Case></Cases>
</Function><Function
 Type="SpeedAndDistanceMonitoring.TargetSpeedMonitoring.Target"
 X="1"
 Y="541"
 Width="100"
 Height="50"
 Implemented="TRUE"
 Name="EOAAndSvL"
 Guid="07b09c44-6a9c-4cda-8530-beb2f202d4a1"
>
<ReqRef
 Id="4f290d49-e10d-41ae-a385-d9a756df04d3"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="c2ecce01-3bb9-4897-a018-51eecc77940e"
>
</ReqRef><Comment>If a conditional emergency stop has been accepted by the on-board, the emergency stop location is considered as the EOA and the SvL.</Comment>
<Cases>
<Case
 Name="Conditional emergency stop accepted"
 Guid="f056d65c-f001-4cce-911b-09ede929bb6c"
>
<PreConditions>
<PreCondition
 Guid="9236bd91-f38c-45cb-b48f-1a10ba6614d6"
>THERE_IS X IN Kernel.BrakeCommands.EmergencyStops | ( (X.Reason == Kernel.BrakeCommands.BrakeReason.OrderFromRBC) AND (X.IsConditional) )</PreCondition></PreConditions>
<Expression>MA.CreateTarget(
    aLength =&gt; BaseTypes.Distance.Infinity,
    aLocation =&gt; Kernel.BrakeCommands.ClosestStopLocation( Kernel.BrakeCommands.EmergencyStops ).StopLocation,
    aSpeed =&gt; 0.0
)</Expression>
</Case><Case
 Name="Otherwise"
 Guid="14129b95-8bea-46a0-86e0-ef70fcd816d0"
>
<Expression>EMPTY</Expression>
</Case></Cases>
</Function></Functions>
<Procedures>
<Procedure
 X="30"
 Y="470"
 Width="100"
 Height="50"
 Pinned="TRUE"
 Implemented="TRUE"
 Name="AddEmergencyStop"
 Guid="ceb27117-9325-44f7-88ca-b8341a1a09d6"
>
<ReqRef
 Id="2b2cca84-5637-4f57-be10-029b36aa0f1a"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="4195cc84-95a8-4f19-ac0f-26a5d2694cb3"
>
</ReqRef><ReqRef
 Id="c3434cd8-a28d-4f6f-9aff-3f72b485a528"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="d622edaf-ffd8-40b0-b71c-b535341b6463"
>
</ReqRef><Comment>Adds an emergency stop item to the list from a conditional emergency stop message or from an unconditional emergency stop message.</Comment>
<Parameters>
<Parameter
 Type="Messages.MESSAGE.TRACK_TO_TRAIN.Message"
 Name="aMessage"
 Guid="b1406273-1565-491b-b8e1-82c7a2f264b3"
>
</Parameter></Parameters>
<Rules>
<Rule
 Priority="Processing"
 Implemented="TRUE"
 Name="Add emergency stop"
 Guid="7482b271-0036-4a99-8046-791fdabca1e8"
>
<Comment>Received emergency stops are added to a list containing the ID and reason or each emergency stop</Comment>
<SubRules></SubRules>
<Conditions>
<RuleCondition
 Implemented="TRUE"
 Name="Add Conditional Emergency Stop"
 Guid="17059008-89b6-4e10-a7e3-9938cfc666eb"
>
<Comment>Adds the conditional emergency stop received in the RBC message</Comment>
<PreConditions>
<PreCondition
 Guid="e240d531-4475-416c-bb30-c3574d5dcda4"
>Available ( aMessage.CONDITIONAL_EMERGENCY_STOP )</PreCondition></PreConditions>
<Actions>
<Action
 Guid="9a5fa779-e4b0-4c4a-b5bf-584bb7826348"
>INSERT
Kernel.BrakeCommands.CreateEmergencyStop (
    aIsConditional =&gt; Boolean.True,
    aId =&gt; aMessage.CONDITIONAL_EMERGENCY_STOP.NID_EM,
    aStopLocation =&gt; MessageTypes.QScaleDistance (
        distance =&gt; aMessage.CONDITIONAL_EMERGENCY_STOP.D_EMERGENCYSTOP,
        scale =&gt; aMessage.CONDITIONAL_EMERGENCY_STOP.Q_SCALE
     )
 )

IN
Kernel.BrakeCommands.EmergencyStops</Action></Actions>
</RuleCondition><RuleCondition
 Implemented="TRUE"
 Name="Add Unconditional Emergency Stop"
 Guid="ca987d81-cf62-4efd-b7b6-f4b669f0f48e"
>
<Comment>Adds the unconditional emergency stop received in the RBC message</Comment>
<PreConditions>
<PreCondition
 Guid="ba56b109-d68e-48b6-8d69-8c00d3011ebf"
>Available ( aMessage.UNCONDITIONAL_EMERGENCY_STOP )</PreCondition></PreConditions>
<Actions>
<Action
 Guid="f4288555-85c3-46ca-85a6-a4a6c45ca5e7"
>INSERT
Kernel.BrakeCommands.CreateEmergencyStop (
    aIsConditional =&gt; Boolean.False,
    aId =&gt; aMessage.UNCONDITIONAL_EMERGENCY_STOP.NID_EM,
    aStopLocation =&gt; 0.0
 )

IN
Kernel.BrakeCommands.EmergencyStops</Action></Actions>
</RuleCondition></Conditions>
</Rule><Rule
 Priority="Processing"
 Implemented="TRUE"
 Name="Display emergency stops"
 Guid="4268dff1-3142-445f-81e3-f146701a7451"
>
<ReqRef
 Id="c3434cd8-a28d-4f6f-9aff-3f72b485a528"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="124f7681-01bf-4cba-ad11-122aa21910a8"
>
</ReqRef><Comment>The received emergency stops are displayed to the driver</Comment>
<SubRules></SubRules>
<Conditions>
<RuleCondition
 Implemented="TRUE"
 Name="Display emergency stops"
 Guid="eb963954-587d-4ac4-8ee7-64cca604e788"
>
<PreConditions>
</PreConditions>
<Actions>
<Action
 Guid="2f4ad37d-fe37-4706-8e7a-4d05f4ffae50"
>DMI.MasterDMI().Out_AcceptedEmergencyStops.Display()</Action></Actions>
</RuleCondition></Conditions>
</Rule></Rules>
</Procedure><Procedure
 X="30"
 Y="350"
 Width="100"
 Height="50"
 Implemented="TRUE"
 NeedsRequirement="FALSE"
 Name="CommandServiceBrake"
 Guid="5a495d62-a2ef-479c-a3b7-11df30c8c67c"
>
<Comment>Adds a new SB command to the list of SB commands.</Comment>
<Parameters>
<Parameter
 Type="BrakeReason"
 Name="Reason"
 Guid="a5c11b88-65cd-4366-9e8b-7b131dc64ed3"
>
</Parameter></Parameters>
<Rules>
<Rule
 Priority="Processing"
 Implemented="TRUE"
 NeedsRequirement="FALSE"
 Name="Add if not present"
 Guid="ef177b28-26ef-4920-8302-761b5e8b0da0"
>
<Comment>Add the specified SB command into the list of SB commands (only if the specified command is not present in that list).</Comment>
<SubRules></SubRules>
<Conditions>
<RuleCondition
 Implemented="TRUE"
 NeedsRequirement="FALSE"
 Name="Add if not present"
 Guid="f132d1b0-4cb1-4f0f-a67d-b9cc1efb43c8"
>
<PreConditions>
<PreCondition
 Guid="2277cfd5-c577-479a-be81-63f5ff686ab8"
>NOT THERE_IS X IN Kernel.BrakeCommands.ServiceBrakeCommands | X == Reason</PreCondition></PreConditions>
<Actions>
<Action
 Guid="6b0ce64e-71c9-413c-ad6b-e7c6a0bf7036"
>INSERT Reason IN Kernel.BrakeCommands.ServiceBrakeCommands</Action></Actions>
</RuleCondition></Conditions>
</Rule></Rules>
</Procedure><Procedure
 X="140"
 Y="470"
 Width="100"
 Height="50"
 Pinned="TRUE"
 Implemented="TRUE"
 NeedsRequirement="FALSE"
 Name="RemoveEmergencyStop"
 Guid="f336793a-dd82-40af-b8d5-efe066418065"
>
<Comment>Remove the emergency stop from the list.</Comment>
<Parameters>
<Parameter
 Type="Messages.NID_EM"
 Name="aId"
 Guid="bdba32de-72c1-49b0-a2df-7f1a7ea0acb4"
>
</Parameter></Parameters>
<Rules>
<Rule
 Priority="Processing"
 Implemented="TRUE"
 NeedsRequirement="FALSE"
 Name="Remove emergency stop from the list"
 Guid="038fc7be-b42d-40e9-81ef-b47310f0a49e"
>
<Comment>Remove the stored emergency stop with the provided ID.</Comment>
<SubRules></SubRules>
<Conditions>
<RuleCondition
 Implemented="TRUE"
 NeedsRequirement="FALSE"
 Name="Remove emergency stop from the list"
 Guid="3def3988-ff76-4cd0-94db-b21625735b26"
>
<PreConditions>
</PreConditions>
<Actions>
<Action
 Guid="eb928e38-b0ef-4a1d-8bc9-6a68b0de2c13"
>REMOVE ALL X.Id == aId IN Kernel.BrakeCommands.EmergencyStops</Action></Actions>
</RuleCondition></Conditions>
</Rule><Rule
 Priority="Processing"
 Implemented="TRUE"
 NeedsRequirement="FALSE"
 Name="Remove driver notification for empty list"
 Guid="fe50f981-7c59-47b7-b6b0-a1f72c7f1116"
>
<Comment>If this empties the list of emergency stops, the notification to the driver is removed.</Comment>
<SubRules></SubRules>
<Conditions>
<RuleCondition
 Implemented="TRUE"
 NeedsRequirement="FALSE"
 Name="Remove driver notification for empty list"
 Guid="2c54b49c-05a7-4cce-b224-8b4cacb10cdb"
>
<PreConditions>
<PreCondition
 Guid="ed27c8f0-85f6-4b6b-a0a1-49ed462fa9b1"
>FORALL X IN Kernel.BrakeCommands.EmergencyStops | X.Reason != Kernel.BrakeCommands.BrakeReason.OrderFromRBC</PreCondition></PreConditions>
<Actions>
<Action
 Guid="e2602b9e-3c0d-4aac-a5bf-d0678874da0e"
>DMI.MasterDMI().Out_AcceptedEmergencyStops.OutputInformation.DoNotDisplay()</Action></Actions>
</RuleCondition></Conditions>
</Rule></Rules>
</Procedure><Procedure
 X="140"
 Y="350"
 Width="100"
 Height="50"
 Implemented="TRUE"
 NeedsRequirement="FALSE"
 Name="ReleaseSBCommand"
 Guid="09f7fe8a-1a47-4e68-97e6-b24cb889655e"
>
<ReqRef
 Id="c4b29bf1-b564-4981-9967-9bc22c91b8f9"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="fc1a78db-902f-419e-a94e-55bff1098421"
>
</ReqRef><ReqRef
 Id="33d6b46d-2f8a-4411-8e48-aa43acd4cce3"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="757762f4-7296-4aba-9fa3-ec0c47c4c755"
>
</ReqRef><Comment>Removes the specified SB command.</Comment>
<Parameters>
<Parameter
 Type="BrakeReason"
 Name="Reason"
 Guid="9fc434a0-e53e-4ee8-95b2-a9dd17195ade"
>
</Parameter></Parameters>
<Rules>
<Rule
 Priority="Processing"
 Implemented="TRUE"
 NeedsRequirement="FALSE"
 Name="Delete from SB commands"
 Guid="caee3add-47e5-4262-aee0-5b811736ed66"
>
<Comment>Remove the specified SB command from the list of SB commands.</Comment>
<SubRules></SubRules>
<Conditions>
<RuleCondition
 Implemented="TRUE"
 NeedsRequirement="FALSE"
 Name="Delete from SB commands"
 Guid="12f7528c-7738-41cf-abd0-ffafacc69e5c"
>
<PreConditions>
</PreConditions>
<Actions>
<Action
 Guid="38d53262-df6c-44d6-b1c6-41d228de97e8"
>REMOVE FIRST X == Reason IN Kernel.BrakeCommands.ServiceBrakeCommands</Action></Actions>
</RuleCondition></Conditions>
</Rule></Rules>
</Procedure><Procedure
 X="30"
 Y="410"
 Width="100"
 Height="50"
 Implemented="TRUE"
 NeedsRequirement="FALSE"
 Name="CommandEmergencyBrake"
 Guid="bf5f88f1-d4e0-47e3-9a9e-6280d5ce6804"
>
<Comment>Adds a new EB command to the list of EB commands.</Comment>
<Parameters>
<Parameter
 Type="BrakeReason"
 Name="Reason"
 Guid="ab4d06ce-5ea9-4096-89b1-60cba74686ee"
>
</Parameter></Parameters>
<Rules>
<Rule
 Priority="Processing"
 Implemented="TRUE"
 NeedsRequirement="FALSE"
 Name="Add if not present"
 Guid="ec11b3ba-2c81-42d4-9855-519dca1f21cd"
>
<Comment>Add the specified EB command into the list of EB commands (only if the specified command is not present in that list).</Comment>
<SubRules></SubRules>
<Conditions>
<RuleCondition
 Implemented="TRUE"
 NeedsRequirement="FALSE"
 Name="Add if not present"
 Guid="5884d6e5-3bb9-42f2-8e7c-fd5b7d5f55be"
>
<PreConditions>
<PreCondition
 Guid="c7497b8b-3030-47ee-a3a3-f9eb29a145f9"
>NOT THERE_IS X IN Kernel.BrakeCommands.EmergencyBrakeCommands | X == Reason</PreCondition></PreConditions>
<Actions>
<Action
 Guid="64ab9c81-b890-4cad-a60e-97c4f903ec11"
>INSERT Reason IN Kernel.BrakeCommands.EmergencyBrakeCommands</Action></Actions>
</RuleCondition></Conditions>
</Rule></Rules>
</Procedure><Procedure
 X="140"
 Y="410"
 Width="100"
 Height="50"
 Implemented="TRUE"
 NeedsRequirement="FALSE"
 Name="ReleaseEBCommand"
 Guid="cf00f7e2-720b-4d73-8cbd-7c15321d9493"
>
<Comment>Removes the specified EB command.</Comment>
<Parameters>
<Parameter
 Type="BrakeReason"
 Name="Reason"
 Guid="42e72205-6194-4f16-8f30-3a73336e74a0"
>
</Parameter></Parameters>
<Rules>
<Rule
 Priority="Processing"
 Implemented="TRUE"
 NeedsRequirement="FALSE"
 Name="Delete from EB commands"
 Guid="5bcbc366-a0a3-4922-bbf9-01d288f0f7a7"
>
<Comment>Remove the specified EB command from the list of EB commands.</Comment>
<SubRules></SubRules>
<Conditions>
<RuleCondition
 Implemented="TRUE"
 NeedsRequirement="FALSE"
 Name="Delete from EB commands"
 Guid="b4df50e3-66b3-48d6-9058-18d380a3ddca"
>
<PreConditions>
</PreConditions>
<Actions>
<Action
 Guid="6b4369fe-e276-4300-8508-59013b043822"
>REMOVE FIRST X == Reason IN Kernel.BrakeCommands.EmergencyBrakeCommands</Action></Actions>
</RuleCondition></Conditions>
</Rule></Rules>
</Procedure><Procedure
 X="1"
 Y="601"
 Width="100"
 Height="50"
 Name="DisplayBrakeReason"
 Guid="e90bf6ef-c4d9-4957-8f45-1f519c75e9ad"
>
<ReqRef
 Id="f4fbf115-c910-46e8-b6e7-bf1fb0f8a4b3"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="bd4fa408-e5ed-40df-ac15-e404afccf231"
>
</ReqRef><Comment>Handles the display of the received brake reason.</Comment>
<Parameters>
<Parameter
 Type="BrakeReason"
 Name="aBrakeReason"
 Guid="1f44f6f0-1389-429f-a983-c112d21066d0"
>
</Parameter></Parameters>
<Rules>
<Rule
 Name="Display"
 Guid="195391a2-a043-488c-8fed-9b34640036f0"
>
<SubRules></SubRules>
<Conditions>
<RuleCondition
 Name="Display balise group message inconsistency"
 Guid="a0a642eb-e1c9-4f2d-bfd0-5c7cd8d04523"
>
<PreConditions>
<PreCondition
 Guid="f0564173-9980-42d7-b924-aaf718255314"
>aBrakeReason == Kernel.BrakeCommands.BrakeReason.BaliseGroupMessageInconsistency</PreCondition></PreConditions>
<Actions>
</Actions>
</RuleCondition><RuleCondition
 Name="Display level transition time-out"
 Guid="73461ad1-a19e-405a-a5a2-ef292aa85efd"
>
<PreConditions>
<PreCondition
 Guid="0c485872-26bf-4f13-abe9-7809bec7c6f3"
>aBrakeReason == Kernel.BrakeCommands.BrakeReason.LevelTransitionTimeOut</PreCondition></PreConditions>
<Actions>
</Actions>
</RuleCondition><RuleCondition
 Name="Display linking inconsistency"
 Guid="213ba8b2-3dfe-4545-bc46-67fcba2a524d"
>
<PreConditions>
<PreCondition
 Guid="f4531365-e029-42e7-bfaf-38644617f5cd"
>aBrakeReason == Kernel.BrakeCommands.BrakeReason.LinkingInconsistency</PreCondition></PreConditions>
<Actions>
</Actions>
</RuleCondition><RuleCondition
 Name="Display time-out of ackn for LS mode"
 Guid="41d0595c-d05c-4d66-9b97-d28da53453a7"
>
<PreConditions>
<PreCondition
 Guid="b8281f8b-4bd6-4176-b9a5-6c1a7c520ecf"
>aBrakeReason == Kernel.BrakeCommands.BrakeReason.LSAckTimeOut</PreCondition></PreConditions>
<Actions>
</Actions>
</RuleCondition><RuleCondition
 Name="Display max time between radio messages exceeded"
 Guid="efd41adc-676c-4353-9236-d1884e62f9ba"
>
<PreConditions>
<PreCondition
 Guid="afd574eb-a426-4d90-9c43-a6b876f78bc4"
>aBrakeReason == Kernel.BrakeCommands.BrakeReason.NoRadioMessageInDueTime</PreCondition></PreConditions>
<Actions>
</Actions>
</RuleCondition><RuleCondition
 Name="Display emergency stop"
 Guid="417c2195-a30b-48f8-9e24-bb253e58d60e"
>
<PreConditions>
<PreCondition
 Guid="f848c7e9-1a48-4773-a3bd-a33527a995f7"
>aBrakeReason == Kernel.BrakeCommands.BrakeReason.OrderFromRBC</PreCondition></PreConditions>
<Actions>
</Actions>
</RuleCondition><RuleCondition
 Name="Display time-out of ackn for OS mode"
 Guid="cf4d5368-b438-457a-8cbd-159342323f9b"
>
<PreConditions>
<PreCondition
 Guid="96382a27-a461-48a0-b36f-903721f8cb94"
>aBrakeReason == Kernel.BrakeCommands.BrakeReason.OSAckTimeOut</PreCondition></PreConditions>
<Actions>
</Actions>
</RuleCondition><RuleCondition
 Name="Display mode-related brake command"
 Guid="ba373dbf-dc52-47fa-8edf-59e74a69f35e"
>
<PreConditions>
<PreCondition
 Guid="6f225181-a011-4798-aa3c-0a5d098a7f38"
>aBrakeReason == Kernel.BrakeCommands.BrakeReason.PermanentCommandInCurrentMode</PreCondition></PreConditions>
<Actions>
</Actions>
</RuleCondition><RuleCondition
 Name="Display reversing distance for PT mode exceeded"
 Guid="81401ac5-b386-49b6-8b50-82fa759f7697"
>
<Comment>Displey the acknowledgement request for braking due to post trip distance exceeded.</Comment>
<PreConditions>
<PreCondition
 Guid="19160b87-f20d-476b-bfdc-e2711367799f"
>aBrakeReason == Kernel.BrakeCommands.BrakeReason.PTReversingDistanceExceeded</PreCondition></PreConditions>
<Actions>
<Action
 Guid="6405b92e-decc-409c-99a8-3f4769cfed4a"
>DMI.MasterDMI().In_AcknForPostTripDistanceExceeded.InitiateRequest()</Action></Actions>
</RuleCondition><RuleCondition
 Name="Display radio message consistency error"
 Guid="e00259c9-8893-450d-b9be-95df810b9006"
>
<PreConditions>
<PreCondition
 Guid="39177f32-b4ff-4777-a262-99d9fae9ff61"
>aBrakeReason == Kernel.BrakeCommands.BrakeReason.RadioMessageConsistencyError</PreCondition></PreConditions>
<Actions>
</Actions>
</RuleCondition><RuleCondition
 Name="Display radio sequence error"
 Guid="ccdd744f-558a-4e05-8b06-db65edca6d20"
>
<PreConditions>
<PreCondition
 Guid="4bbdcc2d-f50a-41a8-8890-ea9d3a5cccf3"
>aBrakeReason == Kernel.BrakeCommands.BrakeReason.RadioSequenceError</PreCondition></PreConditions>
<Actions>
</Actions>
</RuleCondition><RuleCondition
 Name="Display RAMS related supervision error"
 Guid="6add2c01-1c99-4cde-895f-2445362dd83e"
>
<PreConditions>
<PreCondition
 Guid="9ada5197-67a4-47b9-9078-e3a0f603d9f5"
>aBrakeReason == Kernel.BrakeCommands.BrakeReason.RAMSSupervision</PreCondition></PreConditions>
<Actions>
</Actions>
</RuleCondition><RuleCondition
 Implemented="TRUE"
 Name="Display reverse movement protection"
 Guid="7e1321a9-c000-41e6-90d8-4a0ad68e31b4"
>
<ReqRef
 Id="356c897f-ec33-4240-8b7c-f795ee273d64"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="1e0cc063-b97d-4cfd-9d3d-d571e9743250"
>
</ReqRef><Comment>Displey the acknowledgement request for braking due to reverse movement protection.</Comment>
<PreConditions>
<PreCondition
 Guid="fa3d6fc0-ac3f-47f2-a420-06594633ff03"
>aBrakeReason == Kernel.BrakeCommands.BrakeReason.ReverseMovementProtection</PreCondition></PreConditions>
<Actions>
<Action
 Guid="9dca4b47-4686-4679-8955-3d1a182ec68d"
>DMI.MasterDMI().In_AcknForReverseMovementProtection.InitiateRequest()</Action></Actions>
</RuleCondition><RuleCondition
 Name="Display reversing distance exceeded"
 Guid="70e023bc-d3bb-4de6-99dd-d0d6a6c0fdc1"
>
<Comment>Displey the acknowledgement request for braking due to reversing distance exceeded.</Comment>
<PreConditions>
<PreCondition
 Guid="199b83b5-c112-4e3a-b720-69292ff59c06"
>aBrakeReason == Kernel.BrakeCommands.BrakeReason.ReversingDistanceExceeded</PreCondition></PreConditions>
<Actions>
<Action
 Guid="85e315ad-e24e-4ee5-8bb1-4a8cb2bd7c76"
>DMI.MasterDMI().In_AcknForReversingDistanceExceeded.InitiateRequest()</Action></Actions>
</RuleCondition><RuleCondition
 Implemented="TRUE"
 Name="Display roll away protection"
 Guid="882f55c2-cf68-478c-94f2-88e73b34c528"
>
<ReqRef
 Id="8fae9656-3172-4724-ac7f-6cde69800d28"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="4b0a0fa0-0d15-4487-be5a-8253bab71427"
>
</ReqRef><Comment>Displey the acknowledgement request for braking due to roll away protection.</Comment>
<PreConditions>
<PreCondition
 Guid="cc0e14e8-7335-4932-bbf0-7d6684638c2e"
>aBrakeReason == Kernel.BrakeCommands.BrakeReason.RollAwayProtection</PreCondition></PreConditions>
<Actions>
<Action
 Guid="78668021-27fe-4924-93e4-d3d07a9476c7"
>DMI.MasterDMI().In_AcknForRollAwayProtection.InitiateRequest()</Action></Actions>
</RuleCondition><RuleCondition
 Name="Display time-out of ackn for SH mode"
 Guid="86b51931-dc36-4083-86cd-7e1e2c16b028"
>
<PreConditions>
<PreCondition
 Guid="32f69d8c-f9f5-453a-b2ac-b92dc8e9f757"
>aBrakeReason == Kernel.BrakeCommands.BrakeReason.SHAckTimeOut</PreCondition></PreConditions>
<Actions>
</Actions>
</RuleCondition><RuleCondition
 Name="Display brake command resulting from speed and distance monitoring"
 Guid="3cd2ade3-d789-4aba-a3be-6e6eb6f58872"
>
<PreConditions>
<PreCondition
 Guid="26a4a312-83ea-4e09-a932-c8d93ac4e5e8"
>aBrakeReason == Kernel.BrakeCommands.BrakeReason.SpeedAndDistanceMonitoring</PreCondition></PreConditions>
<Actions>
</Actions>
</RuleCondition><RuleCondition
 Implemented="TRUE"
 Name="Display standstill supervision"
 Guid="22baceee-bd47-4938-8117-96ad5e6a6166"
>
<ReqRef
 Id="e87c7aa6-0460-46c8-82ca-66eb5c47b2ae"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="409468b4-7a70-4c45-bb4e-70974c43f1ab"
>
</ReqRef><Comment>Displey the acknowledgement request for braking due to standstill supervision.</Comment>
<PreConditions>
<PreCondition
 Guid="dde5c0f6-c0c0-4bd2-9988-21ca98690bdd"
>aBrakeReason == Kernel.BrakeCommands.BrakeReason.SupervisingStandstill</PreCondition></PreConditions>
<Actions>
<Action
 Guid="26884755-3320-44ea-8154-9fc876cfda5c"
>DMI.MasterDMI().In_AcknForStandstillSupervision.InitiateRequest()</Action><Action
 Guid="2a476e6d-603b-4be2-ae58-7a9d5b0bcbb5"
>Kernel.UndesirableMovement.InitializeStandstillSupervision()</Action></Actions>
</RuleCondition><RuleCondition
 Name="Display time-out of text message ackn"
 Guid="088053a7-cc7b-41a0-912f-b083aad3310c"
>
<PreConditions>
<PreCondition
 Guid="d2e58b15-73d1-4ca3-8de6-065c649e671d"
>aBrakeReason == Kernel.BrakeCommands.BrakeReason.TextMessageAckTimeOut</PreCondition></PreConditions>
<Actions>
</Actions>
</RuleCondition><RuleCondition
 Name="Display change of train data from an external source while the train was running"
 Guid="9766d5fb-3fa8-4bf7-bd9e-11c7be2dae10"
>
<Comment>Displey the acknowledgement request for braking due to change of train data while the train was running.</Comment>
<PreConditions>
<PreCondition
 Guid="710d447f-5ca4-49c7-b3e2-aa48d389a6f7"
>aBrakeReason == Kernel.BrakeCommands.BrakeReason.TrainDataChanged</PreCondition></PreConditions>
<Actions>
<Action
 Guid="df7b9aac-1567-44d3-9ff3-7f58c3f723d7"
>DMI.MasterDMI().In_AcknOfTrainDataChangeFromOtherSource.InitiateRequest()</Action></Actions>
</RuleCondition><RuleCondition
 Name="Display train movement detected during data entry"
 Guid="f8ee70da-3bb2-4bb2-88d2-70d6bf2b329e"
>
<Comment>Displey the acknowledgement request for braking due to train movement during data entry.</Comment>
<PreConditions>
<PreCondition
 Guid="7881a385-4d8a-4ced-b695-de453d8b3058"
>aBrakeReason == Kernel.BrakeCommands.BrakeReason.TrainMovementDuringDataEntry</PreCondition></PreConditions>
<Actions>
<Action
 Guid="af8a73da-4bee-42d1-94a4-e03c0e852f97"
>DMI.MasterDMI().In_AcknOfFixedTextInformation.InitiateRequest(&apos;Runaway movement&apos;)</Action></Actions>
</RuleCondition><RuleCondition
 Name="Display train trip"
 Guid="a70eb7fc-9817-4480-a51a-81c1feb69cf5"
>
<PreConditions>
<PreCondition
 Guid="b4070b5b-dc62-48bd-8480-7e5cc389ad0e"
>aBrakeReason == Kernel.BrakeCommands.BrakeReason.TrainTrip</PreCondition></PreConditions>
<Actions>
</Actions>
</RuleCondition></Conditions>
</Rule></Rules>
</Procedure></Procedures>
<Variables>
<Variable
 Type="EmergencyStopsCol"
 DefaultValue=""
 VariableMode="Internal"
 X="20"
 Y="120"
 Width="100"
 Height="50"
 Pinned="TRUE"
 Implemented="TRUE"
 Name="EmergencyStops"
 Guid="13961675-22c5-406e-905d-a628ef0abf5a"
>
<ReqRef
 Id="2b2cca84-5637-4f57-be10-029b36aa0f1a"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="ff0f661b-1ff8-4d89-b9c3-9920c2e5be19"
>
<Comment>Store the emergency stop messages for reference</Comment>
</ReqRef><ReqRef
 Id="19082c8b-d1cc-4d23-a9da-8581737a0760"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="ff01a9c0-064c-49da-9e3c-7e0a6350c0c7"
>
</ReqRef><ReqRef
 Id="3e7cc969-494c-45a5-b39a-09b8d70e8ee3"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="3ee345c2-0b99-4b40-8956-1b00f302aabf"
>
</ReqRef><ReqRef
 Id="8bf47cec-0b77-42d2-b42f-49c0c29dbcec"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="a52fdbc3-f937-4ba4-b42e-e622867cc194"
>
</ReqRef><Comment>This holds all the different emergency stop messages the train currently has.</Comment>
</Variable><Variable
 Type="BrakesCol"
 DefaultValue="[]"
 VariableMode="Internal"
 X="250"
 Y="350"
 Width="100"
 Height="50"
 Implemented="TRUE"
 Name="ServiceBrakeCommands"
 Guid="61248a07-d7a9-462c-b84e-8b9fbf6afbc0"
>
<Comment>The list of current events that trigger the service brake.</Comment>
</Variable><Variable
 Type="BrakesCol"
 VariableMode="Internal"
 X="250"
 Y="410"
 Width="100"
 Height="50"
 Name="EmergencyBrakeCommands"
 Guid="2c62a443-23eb-49af-b793-919347857f3f"
>
<Comment>The list of current events that trigger the emergency brake.</Comment>
</Variable></Variables>
<Rules>
<Rule
 Priority="Processing"
 X="260"
 Y="20"
 Width="100"
 Height="50"
 Implemented="TRUE"
 Name="Display brake reason"
 Guid="620ca4e2-a41d-40ed-bcb7-c86a3d0a2888"
>
<ReqRef
 Id="f4fbf115-c910-46e8-b6e7-bf1fb0f8a4b3"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="f81a422b-b9b9-4cd0-922c-2d805004083d"
>
</ReqRef><Comment>If any brakes are applied, display the reason and possibly an acknowledgement for the driver.</Comment>
<SubRules></SubRules>
<Conditions>
<RuleCondition
 Implemented="TRUE"
 Name="Display brake reasons"
 Guid="296f7b56-df87-4370-adca-fd26b14eaa74"
>
<PreConditions>
</PreConditions>
<Actions>
<Action
 Guid="c289f399-377f-4df8-adca-a052cb745a1b"
>APPLY Kernel.BrakeCommands.DisplayBrakeReason(X) ON Kernel.BrakeCommands.EmergencyBrakeCommands</Action><Action
 Guid="646527a3-05c3-468d-9050-dc9f8f2b75c3"
>APPLY Kernel.BrakeCommands.DisplayBrakeReason(X) ON Kernel.BrakeCommands.ServiceBrakeCommands</Action></Actions>
<SubRules>
<Rule
 Implemented="TRUE"
 Name="Display TR reason"
 Guid="008236d0-aa11-4107-9e6e-5562edfa224d"
>
<ReqRef
 Id="3e7cc969-494c-45a5-b39a-09b8d70e8ee3"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="149b1ae8-f5ad-440e-8f10-e48a9c0e5c3a"
>
</ReqRef><SubRules></SubRules>
<Conditions>
<RuleCondition
 Implemented="TRUE"
 Name="Display reason for TR mode"
 Guid="1da3a6c2-3279-4f23-b795-09b96bfb7ae0"
>
<PreConditions>
<PreCondition
 Guid="db698431-04ed-49bb-b877-65c637a29172"
>Kernel.Mode == Default.Mode.TR</PreCondition><PreCondition
 Guid="9b89c340-ef51-4c14-bb62-8a7b2d72fba4"
>Kernel.BrakeCommands.EmergencyStops != []</PreCondition></PreConditions>
<Actions>
<Action
 Guid="a3fc4c17-da7a-44f6-a07b-e0a9591ad4dc"
>DMI.MasterDMI().Out_TripReason.Display(
    reason =&gt; (FIRST X IN Kernel.BrakeCommands.EmergencyStops).Reason
)</Action></Actions>
</RuleCondition></Conditions>
</Rule></SubRules>
</RuleCondition></Conditions>
</Rule><Rule
 X="20"
 Y="20"
 Width="100"
 Height="50"
 Implemented="TRUE"
 Name="Supervise service brake application"
 Guid="fa99ec53-19f9-4247-a90b-9303a9e42cae"
>
<ReqRef
 Id="974c99b8-fc9d-44d2-9d0c-04bd368c1dc0"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="b81f5ab1-6b41-4b33-ad85-c607c9aae390"
>
</ReqRef><Comment>If the service brake has been commanded, but it is not applied, command the emergency brake.</Comment>
<SubRules></SubRules>
<Conditions>
<RuleCondition
 Implemented="TRUE"
 Name="Supervise service brake applied"
 Guid="1c48b3bc-3b87-4b87-9c2b-03c98b3c8856"
>
<Comment>If the service brake was commanded but the TIU reports that it is not applied (possibly due to a fault), apply the emergency brake.</Comment>
<PreConditions>
<PreCondition
 Guid="7d27717f-2248-4fe2-a854-1fea475c293e"
>TIU.Brakes.ServiceBrakes.Commanded()
 AND  
NOT TIU.SBApplied</PreCondition></PreConditions>
<Actions>
<Action
 Guid="0cff13a0-0cfb-4f3f-96c0-9257b941c09b"
>Kernel.BrakeCommands.CommandEmergencyBrake(Kernel.BrakeCommands.BrakeReason.ServiceBrakeNotApplied)</Action></Actions>
</RuleCondition><RuleCondition
 Implemented="TRUE"
 Name="Revoke EB command when the SB is revoked"
 Guid="e9bed4e3-d68a-4086-bfd8-5378b179c2b5"
>
<Comment>Once the service brake is applied or the reason to apply the service brake is handled, release the emergency brake command.</Comment>
<PreConditions>
</PreConditions>
<Actions>
<Action
 Guid="6b5798d2-c626-4e93-8285-7165aae9a11c"
>Kernel.BrakeCommands.ReleaseEBCommand(Kernel.BrakeCommands.BrakeReason.ServiceBrakeNotApplied)</Action></Actions>
</RuleCondition></Conditions>
</Rule><Rule
 X="140"
 Y="20"
 Width="100"
 Height="50"
 Implemented="TRUE"
 Name="Revoke brake commands"
 Guid="1bae3f3e-384e-45dd-a1df-708cf9689bfe"
>
<ReqRef
 Id="1f20f64e-8527-4f24-baf7-584ee7c5f841"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="753597b5-ef0f-471a-9300-87e54cc9b738"
>
</ReqRef><ReqRef
 Id="ba7f8c98-781f-404a-b7b8-e679b92c5448"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="b54c7963-588a-420c-9e33-4528242114c6"
>
</ReqRef><ReqRef
 Id="e47d3ca7-b158-4b00-8cff-54ff5de6b32f"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="8f5aedf0-2ac6-4634-b6d4-44c61fb5e5d8"
>
</ReqRef><ReqRef
 Id="1d090478-a64a-43b9-bbaf-2cdfb2d81d32"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="1d7b6f24-8d02-4d49-87b8-5514b7bb11e2"
>
</ReqRef><ReqRef
 Id="8d6f8085-1ab8-4354-a7b3-65a964c3c0c2"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="2694b525-c2b7-41e8-82e3-efca6bd6f687"
>
</ReqRef><ReqRef
 Id="26888377-1b25-4f74-b7e4-d5cd48e22465"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="6ad3eb65-8b3b-4c2e-93c6-4823d7c99e22"
>
</ReqRef><ReqRef
 Id="4ea2399b-19bc-4a32-9cdb-b2028b2e1b01"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="ee4ea5ce-96c8-4d96-9b86-ae14e9b7084b"
>
</ReqRef><ReqRef
 Id="f33618ea-e3d8-4986-80af-e3715207559b"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="f5e44499-bc08-4759-9cb0-9929a5964b74"
>
</ReqRef><ReqRef
 Id="1d244ca0-8fad-4910-be60-7598fead7854"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="6369d73e-bdf9-4037-9e20-03840202279a"
>
</ReqRef><Comment>Revoke active brake commands if possible.</Comment>
<SubRules></SubRules>
<Conditions>
<RuleCondition
 Implemented="TRUE"
 Name="Revoke all applicable brake commands"
 Guid="8f65e0be-25ca-41d9-81e3-4d2a6d0cb2c7"
>
<PreConditions>
</PreConditions>
<Actions>
</Actions>
<SubRules>
<Rule
 Implemented="TRUE"
 Name="Roll away protection"
 Guid="3bed0ee4-f485-4f93-ab06-4c989ade04fb"
>
<ReqRef
 Id="ba7f8c98-781f-404a-b7b8-e679b92c5448"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="08887037-8976-414c-8e89-947c55af6f69"
>
</ReqRef><ReqRef
 Id="5b878cb7-bb66-41bb-96dc-6089f53c8f01"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="0426aa6d-9896-49c4-b103-f0c5ace04a5b"
>
</ReqRef><Comment>Revoke the brake command due to roll away protection.</Comment>
<SubRules></SubRules>
<Conditions>
<RuleCondition
 Implemented="TRUE"
 Name="Release brake command"
 Guid="c0ade701-88f2-4621-8c56-60e6a8d9bcf8"
>
<PreConditions>
<PreCondition
 Guid="332a03fb-1601-4b22-8fb9-ab36a2f19526"
>Odometry.TrainIsAtStandstill()</PreCondition><PreCondition
 Guid="bd09269b-827f-4227-9830-f4c3a7956ec6"
>DMI.MasterDMI().In_AcknForRollAwayProtection.InputInformation.DriverAnswered</PreCondition></PreConditions>
<Actions>
<Action
 Guid="7390e3a2-bfc1-4b6e-8d21-e830cc4dd86c"
>Kernel.BrakeCommands.ReleaseSBCommand(Kernel.BrakeCommands.BrakeReason.RollAwayProtection)</Action><Action
 Guid="29a33d38-33df-4509-87cd-8cd06a04ad0a"
>Kernel.UndesirableMovement.InitializeRollAwayProtection()</Action></Actions>
</RuleCondition></Conditions>
</Rule><Rule
 Implemented="TRUE"
 Name="Reverse movement protection"
 Guid="67f6923b-d43a-4b9a-92f4-2fd91b9b3c51"
>
<ReqRef
 Id="ba7f8c98-781f-404a-b7b8-e679b92c5448"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="39de26ca-05c4-4cf8-9092-4857aefdc79e"
>
</ReqRef><ReqRef
 Id="de3edf27-2461-48e2-9737-d2e812684d28"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="e15c9615-d0c1-4842-8c86-ee6b1b04b6c7"
>
</ReqRef><Comment>Revoke the brake command due to reverse movement protection.</Comment>
<SubRules></SubRules>
<Conditions>
<RuleCondition
 Implemented="TRUE"
 Name="Release brake command"
 Guid="b89b42da-3611-4c01-ac57-5ddaf2eadef9"
>
<PreConditions>
<PreCondition
 Guid="e9b1ad3a-291a-40d1-8cb4-56f4df1e6f84"
>Odometry.TrainIsAtStandstill()</PreCondition><PreCondition
 Guid="ce45dd78-da54-4be8-bc2d-67c7ff6e99b6"
>DMI.MasterDMI().In_AcknForReverseMovementProtection.InputInformation.DriverAnswered</PreCondition></PreConditions>
<Actions>
<Action
 Guid="27916ba4-948e-4ec7-a83d-e4952cc5a37d"
>Kernel.BrakeCommands.ReleaseSBCommand(Kernel.BrakeCommands.BrakeReason.ReverseMovementProtection)</Action><Action
 Guid="4a499668-c7cb-49a9-8d95-1928e78c5cdc"
>Kernel.UndesirableMovement.InitializeReverseMovementProtection()</Action></Actions>
</RuleCondition></Conditions>
</Rule><Rule
 Implemented="TRUE"
 Name="Standstill supervision"
 Guid="616b5735-3923-4507-96e7-93a538690b19"
>
<ReqRef
 Id="ba7f8c98-781f-404a-b7b8-e679b92c5448"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="9fc357e5-9050-45e9-9dc8-16766b06810c"
>
</ReqRef><Comment>Revoke the brake command due to standstill supervision.</Comment>
<SubRules></SubRules>
<Conditions>
<RuleCondition
 Implemented="TRUE"
 Name="Release brake command"
 Guid="180fe756-c6dc-409a-ae2d-059529871eaa"
>
<PreConditions>
<PreCondition
 Guid="efcbdc06-56b3-4467-a56b-34dd3d014fba"
>Odometry.TrainIsAtStandstill()</PreCondition><PreCondition
 Guid="fe99d4ba-d6bb-4ca1-810a-69e43b0c260b"
>DMI.MasterDMI().In_AcknForStandstillSupervision.InputInformation.DriverAnswered</PreCondition></PreConditions>
<Actions>
<Action
 Guid="825818c1-5291-4e6d-b827-d350dfee16ca"
>Kernel.BrakeCommands.ReleaseSBCommand(Kernel.BrakeCommands.BrakeReason.SupervisingStandstill)</Action></Actions>
</RuleCondition></Conditions>
</Rule><Rule
 Implemented="TRUE"
 Name="Linking error"
 Guid="37dc5d2e-c505-44f2-b561-a9838721cc0d"
>
<ReqRef
 Id="e47d3ca7-b158-4b00-8cff-54ff5de6b32f"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="0468ec53-14b7-4d50-a92f-dee5a8d9ad39"
>
</ReqRef><Comment>Revoke the brake command due to a linking error.</Comment>
<SubRules></SubRules>
<Conditions>
<RuleCondition
 Implemented="TRUE"
 Name="Release brake command"
 Guid="daf69e0b-411b-45f3-a7fc-c4e86c0a376c"
>
<PreConditions>
<PreCondition
 Guid="f0da9b49-dc75-4eec-805d-c963447dec90"
>Odometry.TrainIsAtStandstill()</PreCondition></PreConditions>
<Actions>
<Action
 Guid="04d779aa-2479-4e58-99c6-f3f4de631b6f"
>Kernel.BrakeCommands.ReleaseSBCommand(Kernel.BrakeCommands.BrakeReason.LinkingInconsistency)</Action></Actions>
</RuleCondition></Conditions>
</Rule><Rule
 Implemented="TRUE"
 Name="Balise group inconsistency"
 Guid="09aa38c0-cd0c-4b57-902c-9783eab3e9a0"
>
<ReqRef
 Id="e47d3ca7-b158-4b00-8cff-54ff5de6b32f"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="1f63c21c-6b63-4727-a6ee-135e74fdfbee"
>
</ReqRef><Comment>Revoke the brake command due to a balise group message inconsistency.</Comment>
<SubRules></SubRules>
<Conditions>
<RuleCondition
 Implemented="TRUE"
 Name="Release brake command"
 Guid="cf3dd8a9-b400-4f42-9856-fb5aa37ad048"
>
<PreConditions>
<PreCondition
 Guid="7ecc746e-be34-40fe-a2d4-f8df0a4d130c"
>Odometry.TrainIsAtStandstill()</PreCondition></PreConditions>
<Actions>
<Action
 Guid="b848bcc0-298e-47a2-be5f-0bf8626b3e85"
>Kernel.BrakeCommands.ReleaseSBCommand(Kernel.BrakeCommands.BrakeReason.BaliseGroupMessageInconsistency)</Action></Actions>
</RuleCondition></Conditions>
</Rule><Rule
 Implemented="TRUE"
 Name="RAMS supervision"
 Guid="83a76365-1152-411b-b84e-bec672ef760c"
>
<ReqRef
 Id="e47d3ca7-b158-4b00-8cff-54ff5de6b32f"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="c6bd8b2b-778f-4f92-97fa-ec89336d3096"
>
</ReqRef><Comment>Revoke the brake command due to the RAMS supervision.</Comment>
<SubRules></SubRules>
<Conditions>
<RuleCondition
 Implemented="TRUE"
 Name="Release brake command"
 Guid="684b4bd7-a197-42e5-a6b5-d90ff79a23e6"
>
<PreConditions>
<PreCondition
 Guid="f4160ccf-e1e7-4b2e-8adc-4138d44e59e6"
>Odometry.TrainIsAtStandstill()</PreCondition></PreConditions>
<Actions>
<Action
 Guid="eb3e4e6c-6630-466b-928a-f62ca7bdc7ed"
>Kernel.BrakeCommands.ReleaseSBCommand(Kernel.BrakeCommands.BrakeReason.RAMSSupervision)</Action></Actions>
</RuleCondition></Conditions>
</Rule><Rule
 Implemented="TRUE"
 Name="Safe radio connection"
 Guid="e5272d7c-b09b-4849-8282-8bcc12e6153b"
>
<ReqRef
 Id="1d090478-a64a-43b9-bbaf-2cdfb2d81d32"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="4378ceee-4d25-48bf-acc1-c17278958dcb"
>
</ReqRef><ReqRef
 Id="4c72e2f8-34a5-4066-86d2-067ebbdb7465"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="06706927-c12c-48aa-ac8d-c3a6cf8be0bb"
>
</ReqRef><ReqRef
 Id="e7ac0b5d-5b94-4f8d-85af-20c7e79216b9"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="351e310b-8b62-405d-9faa-9b85da146265"
>
</ReqRef><Comment>Revoke the brake command due to the max time between radio messages exceeded.</Comment>
<SubRules></SubRules>
<Conditions>
<RuleCondition
 Implemented="TRUE"
 Name="Release brake command"
 Guid="11c6426b-c6a9-49af-8dc7-dad48a5372cd"
>
<PreConditions>
<PreCondition
 Guid="7b2b2536-4d5a-4f23-8cf5-910edf40659e"
>Odometry.TrainIsAtStandstill()
  OR  
(
  Available(EURORADIO.CurrentRBCConnection().MessageIn)
    AND  
  EURORADIO.IncomingMessageIsConsistent(EURORADIO.CurrentRBCConnection().MessageIn)
)</PreCondition></PreConditions>
<Actions>
<Action
 Guid="341b2ee1-963b-40f4-83df-8cfe04b55e52"
>Kernel.BrakeCommands.ReleaseEBCommand(Kernel.BrakeCommands.BrakeReason.NoRadioMessageInDueTime)</Action></Actions>
</RuleCondition></Conditions>
</Rule><Rule
 Implemented="TRUE"
 Name="Reversing distance exceeded"
 Guid="bf64ad25-e6a8-4c86-aa1f-2ffc728e5dec"
>
<ReqRef
 Id="8d6f8085-1ab8-4354-a7b3-65a964c3c0c2"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="c5e1216c-6e2a-48ab-960d-112fff0d0cba"
>
</ReqRef><Comment>Revoke the brake command due to the reversing distance being exceeded.</Comment>
<SubRules></SubRules>
<Conditions>
<RuleCondition
 Implemented="TRUE"
 Name="Release brake command"
 Guid="220323d5-0d32-4b04-9163-e70067023e79"
>
<PreConditions>
<PreCondition
 Guid="dff02c72-4294-4218-9a1d-83a1e6858c20"
>Kernel.BrakeCommands.CanRevokeReversingBrake()</PreCondition></PreConditions>
<Actions>
<Action
 Guid="747ac8aa-6f1f-47e8-9372-d28a8b67bcf7"
>Kernel.BrakeCommands.ReleaseEBCommand(Kernel.BrakeCommands.BrakeReason.ReversingDistanceExceeded)</Action></Actions>
</RuleCondition></Conditions>
</Rule><Rule
 Implemented="TRUE"
 Name="Change of train data while running"
 Guid="4a41e10c-47b9-45fb-bc7b-ecc780b7ec9f"
>
<ReqRef
 Id="26888377-1b25-4f74-b7e4-d5cd48e22465"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="3a50f09d-c5ce-43c4-b94f-409efc7f23da"
>
</ReqRef><ReqRef
 Id="462a05df-5685-4dab-88f8-7e8563b156f3"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="f5e9797c-5f1e-49b4-9f0c-fc9baaf0b152"
>
</ReqRef><Comment>Revoke the brake command due to a change of the train data from an external source while the train was running.</Comment>
<SubRules></SubRules>
<Conditions>
<RuleCondition
 Implemented="TRUE"
 Name="Release brake command"
 Guid="696e919a-be79-4729-9dca-73596ce8b8e8"
>
<PreConditions>
<PreCondition
 Guid="1373de6f-c878-4410-beef-630cdbc6b3a6"
>Odometry.TrainIsAtStandstill()</PreCondition><PreCondition
 Guid="5ba836d0-1ed6-4ade-9c9d-3600a519e3d0"
>DMI.MasterDMI().In_AcknOfTrainDataChangeFromOtherSource.InputInformation.DriverAnswered</PreCondition></PreConditions>
<Actions>
<Action
 Guid="f89d38da-61a5-47c1-8842-9a41ce8d8e91"
>Kernel.BrakeCommands.ReleaseEBCommand(Kernel.BrakeCommands.BrakeReason.TrainDataChanged)</Action></Actions>
</RuleCondition></Conditions>
</Rule><Rule
 Implemented="TRUE"
 Name="Train movement during driver entry"
 Guid="46485339-ae0e-433e-9914-ccfaff546476"
>
<ReqRef
 Id="4ea2399b-19bc-4a32-9cdb-b2028b2e1b01"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="7411e0e1-52aa-46fb-babb-afa773ef0523"
>
</ReqRef><Comment>Revoke the brake command due to detected train movement while the driver was entering train data or new values for the SR speed/distance.</Comment>
<SubRules></SubRules>
<Conditions>
<RuleCondition
 Implemented="TRUE"
 Name="Release brake command"
 Guid="8b8ced74-546e-45f0-a16e-97b71e0c43bd"
>
<PreConditions>
<PreCondition
 Guid="8d1850ec-455d-441d-a198-52b1e844d096"
>Odometry.TrainIsAtStandstill()</PreCondition><PreCondition
 Guid="5983d6e1-a6de-4d03-924d-b1448b10df1f"
>DMI.MasterDMI().In_AcknOfFixedTextInformation.InputInformation.DriverAnswered</PreCondition><PreCondition
 Guid="4901a458-e358-4f36-a75b-d88638f40f60"
>DMI.MasterDMI().In_AcknOfFixedTextInformation.Text == &apos;Runaway movement&apos;</PreCondition></PreConditions>
<Actions>
<Action
 Guid="0b999da4-8869-4ce6-8ee8-48447f964c24"
>Kernel.BrakeCommands.ReleaseSBCommand(Kernel.BrakeCommands.BrakeReason.TrainMovementDuringDataEntry)</Action></Actions>
</RuleCondition></Conditions>
</Rule><Rule
 Implemented="TRUE"
 Name="Reversing distance in PT exceeded"
 Guid="84e195de-cb2b-4b82-b08b-c1fc4f32fc2e"
>
<ReqRef
 Id="f33618ea-e3d8-4986-80af-e3715207559b"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="59769b70-0499-449d-aa40-dd21a019ec02"
>
</ReqRef><Comment>Revoke the brake command due to the allowed reversing distance in PT being exceeded.</Comment>
<SubRules></SubRules>
<Conditions>
<RuleCondition
 Implemented="TRUE"
 Name="Release brake command"
 Guid="c90a4b10-9802-474d-8c73-75e325f48513"
>
<PreConditions>
<PreCondition
 Guid="112ddc3a-8da7-4af1-ae03-c742a3e4643e"
>Odometry.TrainIsAtStandstill()</PreCondition><PreCondition
 Guid="b930367f-1b23-4738-91d8-c8bd68f26d67"
>DMI.MasterDMI().In_AcknForPostTripDistanceExceeded.InputInformation.DriverAnswered</PreCondition></PreConditions>
<Actions>
<Action
 Guid="96f3e75a-d39a-476e-bc76-0a62f9828d2f"
>Kernel.BrakeCommands.ReleaseSBCommand(Kernel.BrakeCommands.BrakeReason.PTReversingDistanceExceeded)</Action></Actions>
</RuleCondition></Conditions>
</Rule><Rule
 Implemented="TRUE"
 Name="Acknowledgement of a text message"
 Guid="1845f1f1-2330-4734-a325-54aec1336a56"
>
<ReqRef
 Id="1d244ca0-8fad-4910-be60-7598fead7854"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="e2406504-d8ee-46ab-8b9f-6de038581b69"
>
</ReqRef><Comment>Revoke the brake command due to lack of acknowledgement for a text message.</Comment>
<SubRules></SubRules>
<Conditions>
<RuleCondition
 Implemented="TRUE"
 Name="Release brake command"
 Guid="81754f80-c239-4286-9c00-d175278d6322"
>
<PreConditions>
<PreCondition
 Guid="795cef9a-28f8-497d-bba1-7dd3cee88bd1"
>DMI.MasterDMI().In_AcknOfFixedTextInformation.InputInformation.DriverAnswered
  OR  
DMI.MasterDMI().In_AcknOfPlainTextInformation.InputInformation.DriverAnswered</PreCondition></PreConditions>
<Actions>
<Action
 Guid="61898b87-10cf-4244-a5b1-7f1aaa367ef1"
>Kernel.BrakeCommands.ReleaseSBCommand(Kernel.BrakeCommands.BrakeReason.TextMessageAckTimeOut)</Action></Actions>
</RuleCondition></Conditions>
</Rule></SubRules>
</RuleCondition></Conditions>
</Rule></Rules>
</NameSpace>
